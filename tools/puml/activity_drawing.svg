<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1188px" preserveAspectRatio="none" style="width:431px;height:1188px;background:#FFFFFF;" version="1.1" viewBox="0 0 431 1188" width="431px" zoomAndPan="magnify"><defs/><g><ellipse cx="211.75" cy="20" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1.0;"/><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="259" x="82.25" y="50"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="239" x="92.25" y="72.457">Let entSet be a set of Entitlements to revoke</text><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="241" x="91.25" y="105.0938"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="221" x="101.25" y="127.5508">Add all dependent entitlements to entSet</text><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="288" x="67.75" y="160.1875"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="268" x="77.75" y="182.6445">Delete all dependent entitlements from database</text><rect fill="#F1F1F1" height="50.1875" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="220" x="101.75" y="215.2813"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="154" x="111.75" y="237.7383">Delete pools of entitlements</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="200" x="111.75" y="252.832">in entSet that are development pools</text><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="218" x="102.75" y="285.4688"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="198" x="112.75" y="307.9258">Update consumed quantity of entSet</text><rect fill="#F1F1F1" height="50.1875" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="181" x="121.25" y="340.5625"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="161" x="131.25" y="363.0195">Delete all entSet entitlements</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="80" x="134.25" y="378.1133">from database</text><rect fill="#F1F1F1" height="50.1875" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="278" x="72.75" y="410.75"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="258" x="82.75" y="433.207">stackPools = filter Entitlements from entSet that</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="139" x="82.75" y="448.3008">have stacking_id attribute</text><rect fill="none" height="225.0781" style="stroke:#000000;stroke-width:1.5;" width="220" x="101.75" y="470.9375"/><path d="M210.75,470.9375 L210.75,481.5469 L200.75,491.5469 L101.75,491.5469 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="104.75" y="486.4707">for-each-entSet</text><rect fill="#F1F1F1" height="50.1875" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="166" x="128.75" y="508.5469"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="146" x="138.75" y="531.0039">stackPool = find stack pool</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="78" x="138.75" y="546.0977">for entitlement</text><rect fill="#F1F1F1" height="50.1875" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="193" x="115.25" y="578.7344"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="173" x="125.25" y="601.1914">sSet = find all ents that have the</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="63" x="125.25" y="616.2852">stacking_id</text><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="200" x="111.75" y="648.9219"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="180" x="121.75" y="671.3789">Update stackPool based on sSet</text><rect fill="#F1F1F1" height="50.1875" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="257" x="83.25" y="716.0156"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="237" x="93.25" y="738.4727">virtEnts = filter Entitlements from entSet that</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="201" x="93.25" y="753.5664">have virt_limit and are for distributors</text><rect fill="none" height="148.7031" style="stroke:#000000;stroke-width:1.5;" width="409" x="11" y="776.2031"/><path d="M126,776.2031 L126,786.8125 L116,796.8125 L11,796.8125 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="14" y="791.7363">for-each-virtEnts</text><polygon fill="#F1F1F1" points="163.25,813.8125,260.25,813.8125,272.25,825.8125,260.25,837.8125,163.25,837.8125,151.25,825.8125,163.25,813.8125" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="97" x="163.25" y="830.3135">virt_limit == unlimited</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="21" x="130.25" y="823.3955">YES</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="15" x="272.25" y="823.3955">NO</text><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="175" x="23" y="847.8125"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="155" x="33" y="870.2695">Set bonus pool quantity to -1</text><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="190" x="218" y="847.8125"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="170" x="228" y="870.2695">Add back reduced pool quantity</text><polygon fill="#F1F1F1" points="211.75,888.9063,223.75,900.9063,211.75,912.9063,199.75,900.9063,211.75,888.9063" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="50.1875" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="213" x="105.25" y="944.9063"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="130" x="115.25" y="967.3633">mEnts = get all modifier</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="193" x="115.25" y="982.457">entitlements of entSet entitlements;</text><rect fill="#F1F1F1" height="50.1875" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="239" x="92.25" y="1015.0938"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="219" x="102.25" y="1037.5508">Lazily regenerate entitlement certificates</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="69" x="105.25" y="1052.6445">for all mEnts</text><rect fill="#F1F1F1" height="50.1875" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="270" x="76.75" y="1085.2813"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="188" x="86.75" y="1107.7383">Compute compliance status for all</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="250" x="86.75" y="1122.832">Consumers that have an entitlement in entSet</text><ellipse cx="211.75" cy="1166.4688" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1.0;"/><ellipse cx="211.75" cy="1166.4688" fill="#222222" rx="6" ry="6" style="stroke:#111111;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="211.75" x2="211.75" y1="30" y2="50"/><polygon fill="#181818" points="207.75,40,211.75,50,215.75,40,211.75,44" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="211.75" x2="211.75" y1="85.0938" y2="105.0938"/><polygon fill="#181818" points="207.75,95.0938,211.75,105.0938,215.75,95.0938,211.75,99.0938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="211.75" x2="211.75" y1="140.1875" y2="160.1875"/><polygon fill="#181818" points="207.75,150.1875,211.75,160.1875,215.75,150.1875,211.75,154.1875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="211.75" x2="211.75" y1="195.2813" y2="215.2813"/><polygon fill="#181818" points="207.75,205.2813,211.75,215.2813,215.75,205.2813,211.75,209.2813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="211.75" x2="211.75" y1="265.4688" y2="285.4688"/><polygon fill="#181818" points="207.75,275.4688,211.75,285.4688,215.75,275.4688,211.75,279.4688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="211.75" x2="211.75" y1="320.5625" y2="340.5625"/><polygon fill="#181818" points="207.75,330.5625,211.75,340.5625,215.75,330.5625,211.75,334.5625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="211.75" x2="211.75" y1="390.75" y2="410.75"/><polygon fill="#181818" points="207.75,400.75,211.75,410.75,215.75,400.75,211.75,404.75" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="211.75" x2="211.75" y1="558.7344" y2="578.7344"/><polygon fill="#181818" points="207.75,568.7344,211.75,578.7344,215.75,568.7344,211.75,572.7344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="211.75" x2="211.75" y1="628.9219" y2="648.9219"/><polygon fill="#181818" points="207.75,638.9219,211.75,648.9219,215.75,638.9219,211.75,642.9219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="211.75" x2="211.75" y1="460.9375" y2="508.5469"/><polygon fill="#181818" points="207.75,498.5469,211.75,508.5469,215.75,498.5469,211.75,502.5469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="211.75" x2="211.75" y1="684.0156" y2="716.0156"/><polygon fill="#181818" points="207.75,706.0156,211.75,716.0156,215.75,706.0156,211.75,710.0156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="151.25" x2="110.5" y1="825.8125" y2="825.8125"/><line style="stroke:#181818;stroke-width:1.0;" x1="110.5" x2="110.5" y1="825.8125" y2="847.8125"/><polygon fill="#181818" points="106.5,837.8125,110.5,847.8125,114.5,837.8125,110.5,841.8125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="272.25" x2="313" y1="825.8125" y2="825.8125"/><line style="stroke:#181818;stroke-width:1.0;" x1="313" x2="313" y1="825.8125" y2="847.8125"/><polygon fill="#181818" points="309,837.8125,313,847.8125,317,837.8125,313,841.8125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="110.5" x2="110.5" y1="882.9063" y2="900.9063"/><line style="stroke:#181818;stroke-width:1.0;" x1="110.5" x2="199.75" y1="900.9063" y2="900.9063"/><polygon fill="#181818" points="189.75,896.9063,199.75,900.9063,189.75,904.9063,193.75,900.9063" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="313" x2="313" y1="882.9063" y2="900.9063"/><line style="stroke:#181818;stroke-width:1.0;" x1="313" x2="223.75" y1="900.9063" y2="900.9063"/><polygon fill="#181818" points="233.75,896.9063,223.75,900.9063,233.75,904.9063,229.75,900.9063" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="211.75" x2="211.75" y1="766.2031" y2="813.8125"/><polygon fill="#181818" points="207.75,803.8125,211.75,813.8125,215.75,803.8125,211.75,807.8125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="211.75" x2="211.75" y1="912.9063" y2="944.9063"/><polygon fill="#181818" points="207.75,934.9063,211.75,944.9063,215.75,934.9063,211.75,938.9063" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="211.75" x2="211.75" y1="995.0938" y2="1015.0938"/><polygon fill="#181818" points="207.75,1005.0938,211.75,1015.0938,215.75,1005.0938,211.75,1009.0938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="211.75" x2="211.75" y1="1065.2813" y2="1085.2813"/><polygon fill="#181818" points="207.75,1075.2813,211.75,1085.2813,215.75,1075.2813,211.75,1079.2813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="211.75" x2="211.75" y1="1135.4688" y2="1155.4688"/><polygon fill="#181818" points="207.75,1145.4688,211.75,1155.4688,215.75,1145.4688,211.75,1149.4688" style="stroke:#181818;stroke-width:1.0;"/><!--MD5=[d3034cf904456c98b768d08d367b801b]
@startuml
start
:Let entSet be a set of Entitlements to revoke;
:Add all dependent entitlements to entSet;
:Delete all dependent entitlements from database;
:Delete pools of entitlements 
in entSet that are development pools;
:Update consumed quantity of entSet;
:Delete all entSet entitlements
 from database;
:stackPools = filter Entitlements from entSet that
have stacking_id attribute;
partition for-each-entSet {
:stackPool = find stack pool  
for entitlement;
:sSet = find all ents that have the 
stacking_id;
:Update stackPool based on sSet;
}
:virtEnts = filter Entitlements from entSet that 
have virt_limit and are for distributors;
partition for-each-virtEnts {
if (virt_limit == unlimited) then
-> YES;
:Set bonus pool quantity to -1;
else
-> NO;
:Add back reduced pool quantity;
endif
}
:mEnts = get all modifier 
entitlements of entSet entitlements;;
:Lazily regenerate entitlement certificates 
 for all mEnts;
:Compute compliance status for all 
Consumers that have an entitlement in entSet;
stop
@enduml

PlantUML version 1.2022.8(Sun Sep 25 04:00:33 CDT 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>